#!/usr/bin/env ruby

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), *%w[.. lib])
require 'tcf2nif'
require 'trollop'

opts = Trollop::options do
  synopsis 'Creates NIF documents from a TCF file (generated by WebLicht)'
  usage "Usage: #{__FILE__} sourcefile [OPTIONS]"
  opt :input_file,  "The file containing the plain text document to be converted", type: :string
  opt :output_file, "The file name to be used for the output file", type: :string
  opt :format,      "The output file format", type: :string, default: 'n3'
end
puts opts

if opts[:input_file] && opts[:output_file] && opts[:format]
  @tcf_file = File.open(opts[:input_file], 'r')
  @tcf_doc = Tcf2Nif::TcfDocument.new(@tcf_file)
  @trans = Tcf2Nif::Transformer.new(@tcf_doc, {})
  @graph = @trans.transform(:noprov)
  RDF::Writer.open(opts[:output_file], :format => :ntriples) do |writer|
    writer << RDF::Repository.new do |repo|
      repo << @graph
    end
  end
else
  Trollop::educate
  exit(1)
end
